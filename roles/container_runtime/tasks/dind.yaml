---
- name: Install Docker
  community.general.apk:
    name: docker
    state: present
    update_cache: true
  tags:
    - default
    - setup

- name: Enable Docker service
  ansible.builtin.service:
    name: docker
    enabled: true
    state: started
    runlevel: default
  tags:
    - default
    - setup

- name: Create Docker serviceaccount
  ansible.builtin.user:
    name: dockeruser
    system: true
    shell: /bin/false
    create_home: false
    append: true
    groups: docker
  tags:
    - default
    - setup

- name: Grant limited permissions to Docker serviceaccount
  community.general.sudoers:
    name: dockeruser
    user: dockeruser
    commands:
      - /usr/bin/docker ps
      - /usr/bin/docker run
    nopassword: true

